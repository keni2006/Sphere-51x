# SphereServer-0.51x

Potential Update to the Recovered 0.51a aka (0.52) Source given by Westy before he passed.  
[Source Archive](https://github.com/Sphereserver/Source-Archive/tree/main/0.52)

![SphereServer](https://avatars.githubusercontent.com/u/7201959?s=200&v=4) 

[![Download](https://img.shields.io/badge/Download-Release-blue.svg)](https://github.com/keni2006/Sphere-51x/releases) 
[![Issues](https://img.shields.io/badge/Report-Issue-red.svg)](https://github.com/keni2006/Sphere-51x/issues) 
[![Contribution](https://img.shields.io/badge/Contribute-Guidelines-green.svg)](https://github.com/keni2006/Sphere-51x/blob/main/CONTRIBUTING.md) 

## üöÄ GLOBAL TODO

- Fix some problems with the protocol.
- Fix server crashes after using incorrect values and parameters in scripts.
- Ensure PvM and PvP points charge correctly by zones.
- Implement MySQL data store without `SAVEWORLD`.


### üéâ Features:
`src.pvpPoints`
`color names abyss style`
`color output console`
`src.sysmessage Hello world^–ü—Ä–∏–≤–µ—Ç –º–∏—Ä`
`no duplicates names on character`

## üóÑÔ∏è MySQL backend

Sphere 0.51x now ships with an optional MySQL storage layer that is capable of
keeping accounts, world saves, GM pages, server listings and timers inside a
relational database instead of flat `.scp` files.

### Minimum requirements

- MySQL Server **5.7** or newer (MariaDB **10.3**+ works as well) with InnoDB
  and `utf8mb4` enabled.
- MySQL Connector/C (libmysqlclient) **5.7**+ or an equivalent MariaDB client
  library available during compilation.
- When building with Visual Studio set the environment variables
  `MYSQL_INCLUDE_DIR` and `MYSQL_LIB_DIR`, or update the project properties so
  the compiler can locate the headers and libraries.

### New configuration keys (`spheredef.ini`)

| Key          | Description |
| ------------ | ----------- |
| `MYSQL`      | `0`/`1` toggle. When enabled the server attempts to connect to the configured MySQL instance during boot. |
| `MYSQLHOST`  | MySQL host name or IP. Defaults to `localhost`. |
| `MYSQLPORT`  | TCP port, defaults to `3306`. |
| `MYSQLUSER`  | Database user that has permission to create tables and run DDL. |
| `MYSQLPASS`  | Password for the database user. |
| `MYSQLDB`    | Database/schema name where the tables will be created. |
| `MYSQLPREFIX`| Optional prefix that is prepended to every table (useful when sharing the schema with other applications). |

Additional tuning knobs such as automatic reconnect behaviour live in the
`[SPHERE]` section and are documented inline in `GraySvr/spheredef.ini`.

### First time migration

1. Configure the keys above and make sure the MySQL user can create tables in
   the target schema.
2. Start the server. During the first boot the migrations defined in
   `GraySvr/CWorldStorageMySQL.cpp` will create all tables (see also
   `docs/mysql-schema.sql`).
3. Account data is imported automatically the first time the server connects to
   MySQL while the legacy `sphereaccu.scp` file is still present. Existing
   database rows are never overwritten.
4. Perform a manual `SAVE 0` (or wait for the scheduled world save) to populate
   the new world persistence tables. The server tracks the process and will
   resume if it was interrupted.
5. Validate the schema status with:

   ```sql
   SELECT id, version FROM `<prefix>schema_version` ORDER BY id;
   ```

   `id = 1` should report version **3** after all migrations completed, while
   `id = 2` flips to **1** once the legacy account import finished. Rows **3**
   and **4** record the save counter and whether the last save completed
   successfully.

### Documentation

- `docs/database-schema.md` ‚Äì textual description of the schema.
- `docs/mysql-schema.sql` ‚Äì example SQL dump that reflects the structure
  generated by the built-in migrations.

## ü§ù Contributing

If you would like to contribute, please fork the repository and create a pull request. For more details, check our [Contribution Guidelines](https://github.com/keni2006/Sphere-51x/blob/main/CONTRIBUTING.md).

## üìù License

This project is licensed under the MIT License - see the [LICENSE](https://github.com/keni2006/Sphere-51x/blob/main/LICENSE) file for details.
